<!DOCTYPE HTML>
<html>
  <head>
    <title i18n="options"></title>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <style type="text/css">
      body {
        padding-left: 25px;
        font: 14px arial;
      }
      fieldset {
        -webkit-border-radius: 4px;
        border: 1px solid #666666;
        background-color: #f8faff;
      }
      legend {
        padding: 0 5px;
      }
      label {
        padding-left: 5px;
        cursor: pointer;
      }
      h1 {
        margin: 12px 18px;
      }
      .saved {
        color: blue;
        opacity: 0;
        margin-left: 75px;
      }
    </style>
  </head>
  <body>
    <h1 i18n="options"></h1>
    <fieldset>
      <legend i18n="emailservice"></legend>
      <input name="mail" type="radio" id="fastmail"/><label for="fastmail">Fastmail</label>
      <span class="saved" id="mail" i18n="saved"></span><br/>
      <input name="mail" type="radio" id="gmail"/><label for="gmail">Gmail</label><br/>
      <input name="mail" type="radio" id="hotmail"/><label for="hotmail">Hotmail / Windows Live Mail</label><br/>
      <input name="mail" type="radio" id="ymail"/><label for="ymail">Yahoo mail</label><br/>
      <input name="mail" type="radio" id="zoho"/><label for="zoho">Zoho mail</label><br/>
    </fieldset>
    <script>
      // Set the option if it was already set before
      if (window.localStorage.mail) {
        document.getElementById(window.localStorage.mail).checked = true;
      }

      var hideInterval = null, saveLabelFadeOut = function() {
        // Fade out. If there are no more labels to fade out -> delete interval
        var i, items = document.getElementsByClassName("saved"), fadingLabelsCount = 0;
        for (i=0; i<items.length; i++) {
          if (!items[i].style || !items[i].style.opacity || items[i].style.opacity < 0.05) {
            items[i].style.opacity = 0;
            if (!fadingLabelsCount && i === items.length - 1) {
              window.clearInterval(hideInterval);
              hideInterval = null;
            }
          } else {
            items[i].style.opacity = items[i].style.opacity - 0.03;
            fadingLabelsCount++;
          }
        }
      };
      var setSetting = function(e) {
        // Save and show the correct 'saved' message
        window.localStorage[e.target.name] = e.target.id;
        document.getElementById(e.target.name).style.opacity = 1;
        if (!hideInterval) {
          hideInterval = window.setInterval(saveLabelFadeOut, 200);
        }
      };
      // Trigger when an input element changes
      var i, items = document.getElementsByTagName("input");
      for (i=0; i<items.length; i++) {
        items[i].addEventListener("change", setSetting);
      }

      // Translate a page into the users language
      items = document.querySelectorAll("[i18n]");
      for (i=0; i<items.length; i++) {
        items[i].innerText = chrome.i18n.getMessage(items[i].getAttribute("i18n"));
      }
    </script>
  </body>
</html>