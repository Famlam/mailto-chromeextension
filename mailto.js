window.addEventListener("load",function(){var i;var s=[];var t=document.querySelectorAll("[href], form[action]");for(i=0;i<t.length;i++){if(/^mailto\:/i.test(t[i].href||t[i].action)){s.push(t[i])}}window.removeEventListener("load",arguments.callee);if(s.length){var u=function(e){chrome.extension.sendRequest("email",function(j){var i;var k="";var l=e.target;if(l.nodeName==="FORM"){k=l.action.replace(/\?.*$/,"");for(i=0;i<l.length;i++){if(l[i].name&&l[i].value){k+="&"+window.escape(l[i].name)+"="+window.escape(l[i].value)}}}else{while(!l.href&&l.parentNode){l=l.parentNode}k=l.href}if(!/^mailto\:/i.test(k||"")){return}var m={};var n=("to="+k.substr(7)).replace(/\?/,'&').split('&');for(i=0;i<n.length;i++){var o=n[i].split('=');var p=o[0].toLowerCase();if(m[p]){if(o[1]&&(p==="to"||p==="bcc"||p==="cc")){o[1]=m[p]+", "+o[1]}else if(p==="body"){o[1]=m[p]+"%0D%0A"+o[1]}}if(o[1]){m[p]=window.unescape(o[1])}}var q=function(a,b,c,d){var e="";if(a&&b!==undefined){e=a;if(c){e=e.replace(/(^|\,)[^\,]*\<(.+?\@.+?\..+?)\>/g,"$1$2");if(d){e=e.replace(/\,/g,';')}}e=b+window.escape(e)}return e};var r=function(a,b,c,d,e,f,g){var h=q(b.to,"",true,g)+q(b.cc,c,true,g)+q(b.bcc,d,true)+q(b.subject,e)+q(b.body,f);if(g){h=window.escape(h)}window.open(a+h)};switch(j){case"wlm":case"hotmail":r("http://mail.live.com/?rru=compose%3FTo%3D",m,"&CC=",undefined,"&subject=","&body=",true);break;case"gmail":r("https://mail.google.com/mail/?view=cm&tf=1&to=",m,"&cc=","&bcc=","&su=","&body=");break;case"ymail":r("http://compose.mail.yahoo.com/?To=",m,"&Cc=","&Bcc=","&Subj=","&Body=");break;case"zoho":r("https://zmail.zoho.com/mail/compose.do?extsrc=mailto&mode=compose&tp=zb&ct=",m);break;case"fastmail":r("http://ssl.fastmail.fm/action/compose/?to=",m,"&cc=","&bcc=","&subject=","&body=");break}});e.preventDefault()};for(i=0;i<s.length;i++){s[i].addEventListener(s[i].nodeName==="FORM"?"submit":"click",u)}}});