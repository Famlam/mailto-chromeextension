window.addEventListener("load",function(){var i;var v=[];var w=document.querySelectorAll("[href], form[action]");for(i=0;i<w.length;i++){if(/^mailto\:.+/i.test(w[i].href||w[i].action+"?")){v.push(w[i])}}window.removeEventListener("load",arguments.callee);if(v.length){var x=function(e){chrome.extension.sendRequest("email",function(f){var g=function(a,b,c,d){if(!a){return""}if(c){a=a.replace(/(^|\,)[^\,]*\<(.+?\@.+?\..+?)\>/g,"$1$2")}if(d){a=a.replace(/\,/g,';')}return(b||"")+window.escape(a)};var i;var h="";if(e.target.nodeName==="FORM"){h=e.target.action.replace(/\?.*$/,"")+"?";for(i=0;i<e.target.length;i++){var j=e.target[i];if(j.name&&j.value){h+="&"+window.escape(j.name)+"="+window.escape(j.value)}}}else{var k=e.target;while(!k.href&&k.parentNode){k=k.parentNode}h=k.href}if(!/^mailto\:.+/i.test(h||"")){return}var l={};var m=("to="+h.substr(7)).replace(/\?/,'&').split('&');for(i=0;i<m.length;i++){var n=m[i].split('=');var o=n[0].toLowerCase();if(l[o]){if(n[1]&&(o==="to"||o==="bcc"||o==="cc")){n[1]=l[o]+", "+n[1]}else if(o==="body"){n[1]=l[o]+"%0D%0A"+n[1]}}if(n[1]){l[o]=window.unescape(n[1])}}var p="";switch(f){case"wlm":case"hotmail":var q="compose?To="+g(l.to,"",true,true)+g(l.cc,"&CC=",true,true)+g(l.subject,"&subject=")+g(l.body,"&body=");p="http://mail.live.com/?rru="+window.escape(q);break;case"gmail":var r=g(l.to,"",true)+g(l.cc,"&cc=",true)+g(l.bcc,"&bcc=",true)+g(l.subject,"&su=")+g(l.body,"&body=");p="https://mail.google.com/mail/?view=cm&tf=1&to="+r;break;case"ymail":var s=g(l.to,"",true)+g(l.cc,"&Cc=",true)+g(l.bcc,"&Bcc=",true)+g(l.subject,"&Subject=")+g(l.body,"&Body=");p="http://compose.mail.yahoo.com/?To="+s;break;case"zoho":var t=g(l.to,"",true);p="https://zmail.zoho.com/mail/compose.do?extsrc=mailto&mode=compose&tp=zb&ct="+t;break;case"fastmail":var u=g(l.to,"",true)+g(l.cc,"&cc=",true)+g(l.bcc,"&bcc=",true)+g(l.subject,"&subject=")+g(l.body,"&body=");p="http://ssl.fastmail.fm/action/compose/?to="+u;break}window.open(p)});e.preventDefault()};for(i=0;i<v.length;i++){v[i].addEventListener(v[i].nodeName==="FORM"?"submit":"click",x)}}});