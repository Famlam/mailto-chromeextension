var a=function(e){var i;var p="";var q=e.target;if(e.type==="click"){while(!q.href&&q.parentNode){q=q.parentNode}p=q.href}else if(q.action){p=q.action.replace(/\?.*$/,"");for(i=0;i<q.length;i++){if(q[i].name&&q[i].value){p+="&"+window.escape(q[i].name)+"="+window.escape(q[i].value)}}}var r=/^mailto\:(\/\/)?/i;if(!p||!r.test(p)){return}chrome.extension.sendRequest("email",function(h){var j={};var k=("to="+p.replace(r,'')).replace('?','&').split('&');for(i=0;i<k.length;i++){var l=k[i].split('=');var m=l[0].toLowerCase();if(j[m]){if(l[1]&&(m==="to"||m==="bcc"||m==="cc")){l[1]=j[m]+", "+l[1]}else if(m==="body"){l[1]=j[m]+"%0D%0A"+l[1]}}if(l[1]){j[m]=window.unescape(l[1])}}var n=function(a,b,c,d){var e="";if(a&&b!==undefined){e=a;if(c){e=e.replace(/(^|\,)[^\,]*\<(.+?\@.+?\..+?)\>/g,"$1$2");if(d){e=e.replace(/\,/g,';')}}e=b+window.escape(e)}return e};var o=function(a,b,c,d,e,f){var g=n(j.to,"",true,f)+n(j.cc,b,true,f)+n(j.bcc,c,true)+n(j.subject,d)+n(j.body,e);if(f){g=window.escape(g)}window.open(a+g)};switch(h){case"wlm":case"hotmail":o("http://mail.live.com/?rru=compose%3FTo%3D","&CC=",undefined,"&subject=","&body=",true);break;case"gmail":o("https://mail.google.com/mail/?view=cm&tf=1&to=","&cc=","&bcc=","&su=","&body=");break;case"ymail":o("http://compose.mail.yahoo.com/?To=","&Cc=","&Bcc=","&Subj=","&Body=");break;case"zoho":o("https://zmail.zoho.com/mail/compose.do?extsrc=mailto&mode=compose&tp=zb&ct=");break;case"fastmail":o("http://ssl.fastmail.fm/action/compose/?to=","&cc=","&bcc=","&subject=","&body=");break}});e.preventDefault()};document.addEventListener("submit",a);document.addEventListener("click",a);