window.addEventListener("load",function(){var i;var w=[];var x=document.querySelectorAll("[href], form[action]");for(i=0;i<x.length;i++){if(/^mailto\:.+/i.test(x[i].href||x[i].action+"?")){w.push(x[i])}}window.removeEventListener("load",arguments.callee);if(w.length){var y=function(e){chrome.extension.sendRequest("email",function(f){var g=function(a,b,c,d){if(!a){return""}if(c){a=a.replace(/(^|\,)[^\,]*\<(.+?\@.+?\..+?)\>/g,"$1$2")}if(d){a=a.replace(/\,/g,';')}return(b||"")+window.escape(a)};var i;var h="";if(e.target.nodeName==="FORM"){for(i=0;i<e.target.length;i++){var j=e.target[i];if(j.name&&j.value){h+="&"+window.escape(j.name)+"="+window.escape(j.value)}}h=h.replace(/^\&/,"mailto:?")}else{var k=e.target;while(!k.href&&k.parentNode){k=k.parentNode}h=k.href}var l=(h||"").match(/^mailto\:(.+)$/i);if(!l){return}var m={};var n=("to="+l[1]).replace(/\?/,'&').split('&');for(i=0;i<n.length;i++){var o=n[i].split('=');var p=o[0].toLowerCase();if(m[p]){if(o[1]&&(p==="to"||p==="bcc"||p==="cc")){o[1]=m[p]+", "+o[1]}else if(p==="body"){o[1]=m[p]+"%0D%0A"+o[1]}}if(o[1]){m[p]=window.unescape(o[1]||"")}}var q="";switch(f){case"wlm":case"hotmail":var r="compose?To="+g(m.to,"",true,true)+g(m.cc,"&CC=",true,true)+g(m.subject,"&subject=")+g(m.body,"&body=");q="http://mail.live.com/?rru="+window.escape(r);break;case"gmail":var s=g(m.to,"",true)+g(m.cc,"&cc=",true)+g(m.bcc,"&bcc=",true)+g(m.subject,"&su=")+g(m.body,"&body=");q="https://mail.google.com/mail/?view=cm&tf=1&to="+s;break;case"ymail":var t=g(m.to,"",true)+g(m.cc,"&Cc=",true)+g(m.bcc,"&Bcc=",true)+g(m.subject,"&Subject=")+g(m.body,"&Body=");q="http://compose.mail.yahoo.com/?To="+t;break;case"zoho":var u=g(m.to,"",true);q="https://zmail.zoho.com/mail/compose.do?extsrc=mailto&mode=compose&tp=zb&ct="+u;break;case"fastmail":var v=g(m.to,"",true)+g(m.cc,"&cc=",true)+g(m.bcc,"&bcc=",true)+g(m.subject,"&subject=")+g(m.body,"&body=");q="http://ssl.fastmail.fm/action/compose/?to="+v;break}window.open(q)});e.preventDefault()};for(i=0;i<w.length;i++){w[i].addEventListener(w[i].nodeName==="FORM"?"submit":"click",y)}}});